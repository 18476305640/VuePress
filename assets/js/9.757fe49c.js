(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{284:function(t,a,s){"use strict";s.r(a);var n=s(10),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[t._v("#")]),t._v(" Jenkins")]),t._v(" "),a("h2",{attrs:{id:"目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[t._v("#")]),t._v(" 目录")]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#%E7%8E%AF%E5%A2%83%E7%9A%84%E5%AE%89%E8%A3%85"}},[t._v("【环境的安装】")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#gitlab%E5%AE%89%E8%A3%85"}},[t._v("【GitLab安装】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#jenkins%E5%AE%89%E8%A3%85"}},[t._v("【Jenkins安装】")])])])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E4%BB%8Egitlab%E4%B8%8A%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81"}},[t._v("从gitlab上拉取代码")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%8A%A0%E5%85%A5maven%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E6%89%93%E5%8C%85"}},[t._v("加入Maven进行自动构建打包")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#web%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE"}},[t._v("【Web服务器】项目部署服务器的创建与配置")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E5%AE%9E%E7%8E%B0%E8%87%AA%E7%94%B1%E9%A3%8E%E6%A0%BC%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA"}},[t._v("【构建】实现自由风格的项目构建")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E6%94%B9%E5%8A%A8%E5%90%8E%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"}},[t._v("改动后持续集成")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E4%BD%BF%E7%94%A8maven%E8%BF%9B%E8%A1%8C%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA"}},[t._v("【构建】使用Maven进行项目构建")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E4%BD%BF%E7%94%A8%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%BF%9B%E8%A1%8C%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA"}},[t._v("【构建】使用流水线进行项目构建")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E6%94%B9%E4%B8%BA%E9%A1%B9%E7%9B%AE%E6%9C%AC%E5%9C%B0"}},[t._v("改为项目本地：")])])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E8%A7%A6%E5%8F%91%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8"}},[t._v("【触发】项目构建触发器")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#1%E8%A7%A6%E5%8F%91%E8%BF%9C%E7%A8%8B%E6%9E%84%E5%BB%BA"}},[t._v("1、触发远程构建")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#2%E5%85%B6%E5%AE%83%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA%E5%90%8E%E8%A7%A6%E5%8F%91"}},[t._v("2、其它工程构建后触发")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#3%E5%AE%9A%E6%97%B6%E6%9E%84%E5%BB%BA"}},[t._v("3、定时构建")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#4%E8%BD%AE%E8%AF%A2-scm"}},[t._v("4、轮询 SCM")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#5%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93%E8%A7%A6%E5%8F%91%E6%9E%84%E5%BB%BA"}},[t._v("5、代码仓库触发构建")])])])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%89%AF%E5%8A%A0%E5%8F%82%E6%95%B0%E5%8C%96%E6%9E%84%E5%BB%BA"}},[t._v("【副加】参数化构建")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E9%82%AE%E7%AE%B1%E9%82%AE%E7%AE%B1%E5%8A%9F%E8%83%BD"}},[t._v("【邮箱】邮箱功能")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#sonar%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5"}},[t._v("【Sonar代码审查】")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#%E5%AE%89%E8%A3%85"}},[t._v("安装")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#sonar%E4%B8%8Ejenkins%E6%95%B4%E5%90%88"}},[t._v("Sonar与Jenkins整合")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E5%88%B0%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E4%B8%AD"}},[t._v("应用到项目构建中")])])])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%88%86%E5%B8%83%E5%BC%8F%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"}},[t._v("【分布式项目部署】")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#docker%E5%AE%89%E8%A3%85"}},[t._v("【Docker安装】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#docker%E5%91%BD%E4%BB%A4"}},[t._v("【docker命令】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E9%95%9C%E5%83%8F%E7%9A%84%E5%88%B6%E4%BD%9C"}},[t._v("【镜像的制作】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#harbor%E5%AE%89%E8%A3%85"}},[t._v("【Harbor安装】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E9%A1%B9%E7%9B%AE%E4%B8%8E%E7%94%A8%E6%88%B7"}},[t._v("【项目与用户】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F%E5%88%B0harbor"}},[t._v("【推送镜像到Harbor】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E4%BB%8Eharbor%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"}},[t._v("【从Harbor拉取镜像】")])])])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"}},[t._v("【微服务持续集成】")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#%E5%B0%86%E4%BB%A3%E7%A0%81%E4%B8%8A%E4%BC%A0%E5%88%B0gitlab"}},[t._v("【将代码上传到GitLab】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#jenkins%E6%8B%89%E5%8F%96%E4%B8%8E%E6%9E%84%E5%BB%BA"}},[t._v("【Jenkins拉取与构建】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%8A%A0%E5%85%A5%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5"}},[t._v("【加入代码审查】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E7%BC%96%E8%AF%91%E6%89%93%E5%8C%85"}},[t._v("【编译打包】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C"}},[t._v("【镜像制作】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2"}},[t._v("【应用部署】")])])])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E9%83%A8%E7%BD%B2%E4%BC%98%E5%8C%96"}},[t._v("【后端代码部署优化】")])]),t._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#%E4%BB%A3%E7%A0%81%E7%9A%84%E4%BF%AE%E6%94%B9"}},[t._v("【代码的修改】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#jenkins%E4%B8%AD%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"}},[t._v("【jenkins中创建项目】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E4%BB%A3%E7%A0%81%E5%AE%A1%E6%9F%A5"}},[t._v("【代码审查】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E4%B8%8A%E4%BC%A0%E9%95%9C%E5%83%8F%E5%88%B0harbor"}},[t._v("【上传镜像到Harbor】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2-1"}},[t._v("【应用部署】")])])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#%E9%AB%98%E5%8F%AF%E7%94%A8%E7%9A%84nginx"}},[t._v("【高可用的nginx】")])])])])])]),t._v(" "),a("h2",{attrs:{id:"【环境的安装】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【环境的安装】"}},[t._v("#")]),t._v(" 【环境的安装】")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626248340612-1626248340557.png",alt:""}})]),t._v(" "),a("p",[t._v("以下步骤：创建Gitlab服务器与配置-> 创建Jenkins服务与配置")]),t._v(" "),a("p",[t._v("上面两个步骤请参考："),a("a",{attrs:{href:"https://blog.csdn.net/hancoder/article/details/118233786",title:"https://blog.csdn.net/hancoder/article/details/118233786",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.csdn.net/hancoder/article/details/118233786"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"【gitlab安装】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【gitlab安装】"}},[t._v("#")]),t._v(" 【GitLab安装】")]),t._v(" "),a("p",[t._v("Gitlab安装")]),t._v(" "),a("ol",[a("li",[t._v("安装相关依赖")])]),t._v(" "),a("p",[t._v("yum -y install policycoreutils openssh-server openssh-clients postﬁx")]),t._v(" "),a("ol",[a("li",[t._v("启动ssh服务&设置为开机启动")])]),t._v(" "),a("p",[t._v("systemctl enable sshd && sudo systemctl start sshd")]),t._v(" "),a("ol",[a("li",[t._v("设置postﬁx开机自启，并启动，postﬁx支持gitlab发信功能")])]),t._v(" "),a("p",[t._v("systemctl enable postﬁx && systemctl start postﬁx")]),t._v(" "),a("ol",[a("li",[t._v("开放ssh以及http服务，然后重新加载防火墙列表 ﬁrewall-cmd --add-service=ssh --permanent ﬁrewall-cmd --add-service=http --permanent ﬁrewall-cmd --reload")])]),t._v(" "),a("p",[t._v("如果关闭防火墙就不需要做以上配置")]),t._v(" "),a("ol",[a("li",[t._v("下载gitlab包，并且安装在线下载安装包：")])]),t._v(" "),a("p",[t._v("wget "),a("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x",title:"https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el6/gitlab-ce-12.4.2-ce.0.el6.x"),a("OutboundLink")],1),t._v(" 86_64.rpm")]),t._v(" "),a("p",[t._v("安装：")]),t._v(" "),a("p",[t._v("rpm -i gitlab-ce-12.4.2-ce.0.el6.x86_64.rpm")]),t._v(" "),a("ol",[a("li",[t._v("修改gitlab配置")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/gitlab/gitlab.rb\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改gitlab访问地址和端口，默认为80，我们改为82 external_url ‘http://192.168.66.100:82’")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nginx[‘listen_port’] = 82")]),t._v("\n")])])]),a("ol",[a("li",[t._v("重载配置及启动gitlab")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("gitlab-ctl reconﬁgure\ngitlab-ctl restart\n")])])]),a("ol",[a("li",[t._v("把端口添加到防火墙")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ﬁrewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("82")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v(" \nﬁrewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v("\n")])])]),a("p",[t._v("启动成功后，看到以下修改管理员root密码的页面，修改密码后，然后登录即可")]),t._v(" "),a("h3",{attrs:{id:"【jenkins安装】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【jenkins安装】"}},[t._v("#")]),t._v(" 【Jenkins安装】")]),t._v(" "),a("p",[t._v("这里介绍两种方法，一种方法将最新版jenkins加入到yum源，另外一种是下载指定版本的rpm包")]),t._v(" "),a("p",[t._v("1）安装JDK")]),t._v(" "),a("p",[t._v("2）安装jenkins")]),t._v(" "),a("p",[t._v("wget -O ：下载并以不同的文件名保存")]),t._v(" "),a("p",[t._v("yum的repo中默认没有Jenkins，需要先将Jenkins存储库添加到yum repos，执行下面的命令：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-O")]),t._v(" /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--import")]),t._v(" https://pkg.jenkins.io/redhat-stable/jenkins.io.key\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" jenkins "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认安装最新的")]),t._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" jenkins  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开机自启")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/sysconfig/jenkins   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改内容： JENKINS_USER=“root” JENKINS_PORT=“8888”")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" jenkins start  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n")])])]),a("p",[t._v("打开浏览器访问 "),a("a",{attrs:{href:"http://xn--ip-5f7ew23b:8888",title:"http://电脑ip:8888",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://电脑ip:8888"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("创建一个管理员用户 ->  实例配置  -> 可以安装推荐的插件或另一种。")]),t._v(" "),a("p",[t._v("3）配置为国内插件下载地址：")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("cd /var/lib/jenkins/updates\nsed -i 's/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g' default.json\nsed -i 's/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g' default.json\n")])])]),a("p",[t._v("Manage Plugins点击Advanced，把Update Site改为国内插件下载地址：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json",title:"https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Sumbit后，在浏览器输入： "),a("a",{attrs:{href:"http://xn--101ip-fz1iv81h:8888/restart",title:"http://101机器ip:8888/restart",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://101机器ip:8888/restart"),a("OutboundLink")],1),t._v(" ，重启Jenkins")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627721279406-1627721279398.png",alt:""}})]),t._v(" "),a("p",[t._v("4）安装中文插件")]),t._v(" "),a("p",[t._v('安装插件的插件后，会帮我们安装中文插件，如果没有搜索"Chinese"，安装')]),t._v(" "),a("h2",{attrs:{id:"从gitlab上拉取代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从gitlab上拉取代码"}},[t._v("#")]),t._v(" 从gitlab上拉取代码")]),t._v(" "),a("p",[t._v("以下步骤：使用普通凭证从gitlab上拉取代码 ->  使用ssh凭证从gitlab上拉取代码")]),t._v(" "),a("p",[a("code",[t._v("实现在Jenkins上拉取Gitlab上的代码")])]),t._v(" "),a("p",[t._v("在Kenkins上安装Credentials Binding ,安装 Git插件 、在Kenkins服务器上安装git (yum install git -y  && git --version)")]),t._v(" "),a("p",[t._v("1、创建普通凭证")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626250522291-1626250522234.png",alt:""}})]),t._v(" "),a("p",[t._v("2、创建一个项目，从gitlab上拉取代码")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626251037486-1626251037450-image-20210714162315906.png",alt:""}})]),t._v(" "),a("p",[t._v("3、拉取")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626251148690-1626251148679.png",alt:""}})]),t._v(" "),a("p",[a("code",[t._v("使用ssh凭证来拉取")])]),t._v(" "),a("p",[t._v("1、使用ssh-keygen生成ssh，打开/root/.ssh/下cat公钥  复制到gitlab设置中的ssh：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626251665628-1626251665529.png",alt:""}})]),t._v(" "),a("p",[t._v("2、配置ssh凭证")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626252147796-1626252147756-image-20210714164202919.png",alt:""}})]),t._v(" "),a("p",[t._v("3、在Jenkins项目中")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626252294465-1626252294427.png",alt:""}})]),t._v(" "),a("p",[t._v("4、拉取")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626251148690-1626251148679.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"加入maven进行自动构建打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加入maven进行自动构建打包"}},[t._v("#")]),t._v(" 加入Maven进行自动构建打包")]),t._v(" "),a("p",[t._v("就是可以在Jenkins对拉取的代码进行打包")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626258766265-1626258766237.png",alt:""}})]),t._v(" "),a("p",[t._v("以下步骤：服务器上配置需要的环境   --\x3e  Jenkins上配置 --\x3e  对项目进行打包")]),t._v(" "),a("p",[t._v("1、在jenkins的服务器上安装java 、 maven配置环境；")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JAVA_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/jdk/jdk1.8.0_291\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/bin:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/jre/bin:"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CLASSPATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(".:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/lib:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/jre/lib\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#maven")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MAVEN_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local/maven\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MAVEN_HOME")]),t._v("/bin\n")])])]),a("p",[t._v("2、Jenkins上配置")]),t._v(" "),a("p",[t._v("配置1：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626259189981-1626259189950.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626259391664-1626259391644.png",alt:""}})]),t._v(" "),a("p",[t._v("配置2：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627725746059-1627725746011.png",alt:""}})]),t._v(" "),a("p",[t._v("3、对项目进行打包")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626259620762-1626259620743.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【web服务器】项目部署服务器的创建与配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【web服务器】项目部署服务器的创建与配置"}},[t._v("#")]),t._v(" 【Web服务器】项目部署服务器的创建与配置")]),t._v(" "),a("p",[t._v("就是创建项目运行所需的环境，即安装有tomcat服务器，然后配置tomcat")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626248340612-1626248340557.png",alt:""}})]),t._v(" "),a("p",[t._v("1、创建服务器在服务器上安装与配置tomcat")]),t._v(" "),a("p",[t._v("下载 ：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626317633809-1626317633802.png",alt:""}})]),t._v(" "),a("p",[t._v("启动tomcat:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwd")]),t._v("\n/usr/local/tomcat/apache-tomcat-8.5.69/bin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./startup.sh")]),t._v("\n")])])]),a("p",[t._v("开放tomcat的8080端口：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开放8080端口")]),t._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启防火墙")]),t._v("\n")])])]),a("p",[t._v("访问服务器的8080端口，进入指定页面：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626316981745-1626316981736.png",alt:""}})]),t._v(" "),a("p",[t._v("配置1（配置了登录信息）:")]),t._v(" "),a("p",[t._v("vim  /usr/local/tomcat/apache-tomcat-8.5.69/conf/tomcat-users.xml")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tomcat-users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("role1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("manager-script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("manager-gui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("manager-status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("admin-gui"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("role")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rolename")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("admin-script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("user")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("tomcat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("roles")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("manager-gui,manager-script,tomcat,admin-gui,admin-script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tomcat-users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626317427813-1626317427807.png",alt:""}})]),t._v(" "),a("p",[t._v("配置2：")]),t._v(" "),a("p",[t._v("vim   /usr/local/tomcat/apache-tomcat-8.5.69/webapps/manager/META-INF/context.xml")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626317357259-1626317357234.png",alt:""}})]),t._v(" "),a("p",[t._v("重启")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("./shutdown.sh "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#停止")]),t._v("\n./startup.sh "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n")])])]),a("p",[t._v("再次访问或刷新刚才的403页面（上面配置了登录信息是：tomcat  tomcat）：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626317528836-1626317528820.png",alt:""}})]),t._v(" "),a("p",[t._v("显示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626317555591-1626317555588.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【构建】实现自由风格的项目构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【构建】实现自由风格的项目构建"}},[t._v("#")]),t._v(" 【构建】实现自由风格的项目构建")]),t._v(" "),a("p",[t._v("就是jenkins服务器向gitlab服务器获取代码后进行构建，然后将构建好生成的war包部署到tomcat服务器上。我们要做的是设置构建过程。")]),t._v(" "),a("p",[t._v("以下步骤：gitlab服务器项目的准备 ->  jenkins构建环境的准备  -> 开始构建部署")]),t._v(" "),a("p",[a("strong",[t._v("1、gitlab服务器项目的准备")])]),t._v(" "),a("p",[t._v("项目准备："),a("a",{attrs:{href:"https://github.com/18476305640/web_dome",title:"https://github.com/18476305640/web_dome",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/18476305640/web_dome"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("在gitlab上创建一个项目，提交上传，得到："),a("a",{attrs:{href:"mailto:git@192.168.208.136",title:"git@192.168.208.136"}},[t._v("git@192.168.208.136")]),t._v(":zhuangjie/web_demo_freestyle.git")]),t._v(" "),a("p",[a("strong",[t._v("2、jenkins构建环境的准备")])]),t._v(" "),a("p",[t._v("​\t1）安装插件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626409798823-1626409798816.png",alt:""}})]),t._v(" "),a("p",[t._v("​\t2）源码管理")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626410689844-1626410689829.png",alt:""}})]),t._v(" "),a("p",[t._v("​\t3）构建")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626409915126-1626409915107.png",alt:""}})]),t._v(" "),a("p",[t._v("​\t4）构建后操作（新内容）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626410192277-1626410192254-image-20210716123603979.png",alt:""}})]),t._v(" "),a("p",[t._v("​\t"),a("strong",[t._v("3、开始构建")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626410540606-1626410540586.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"改动后持续集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改动后持续集成"}},[t._v("#")]),t._v(" 改动后持续集成")]),t._v(" "),a("p",[t._v("我们能实现三个服务器的联动工作后，我们日常只需要使用git push 将代码上传到gitlab上，然后在jenkins中进行构建即可。")]),t._v(" "),a("h2",{attrs:{id:"【构建】使用maven进行项目构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【构建】使用maven进行项目构建"}},[t._v("#")]),t._v(" 【构建】使用Maven进行项目构建")]),t._v(" "),a("p",[t._v("上面我们使用的是自由风格进行了项目构建，现在我们要进行maven风格来进行项目构建，与之不同的地方并不多。下面就来演示一下：")]),t._v(" "),a("p",[t._v("以下步骤：安装插件  ->  构建项目  -> 查看")]),t._v(" "),a("p",[a("code",[t._v("1、安装插件")])]),t._v(" "),a("p",[t._v("Maven Integration插件，不用重启也可用。")]),t._v(" "),a("p",[a("code",[t._v("2、构建项目")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626417502304-1626417502240.png",alt:""}})]),t._v(" "),a("p",[t._v("部署：")]),t._v(" "),a("p",[t._v("修改代码，push后，点击构建项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626417981588-1626417981549.png",alt:""}})]),t._v(" "),a("p",[a("code",[t._v("3、查看")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626418094970-1626418094944.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【构建】使用流水线进行项目构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【构建】使用流水线进行项目构建"}},[t._v("#")]),t._v(" 【构建】使用流水线进行项目构建")]),t._v(" "),a("p",[t._v("流水线构建项目，构建项目由之前的流程式转为了脚本（Pipeline）,我们创建一个流水线项目后，我们只需编写/生成一个Pipeline 即可完成对项目的拉取、构建、部署等操作。")]),t._v(" "),a("p",[t._v("以下步骤：安装插件（Pipeline，安装推荐的插件中包含）  -> 进行项目构建脚本（Pipeline）书写  ->  查看")]),t._v(" "),a("p",[a("code",[t._v("1、安装插件")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626419582840-1626419582796.png",alt:""}})]),t._v(" "),a("p",[t._v("2、创建一个流水线的项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626425094651-1626425094634.png",alt:""}})]),t._v(" "),a("p",[t._v("3、编写/生成 Pipeline脚本实现项目的拉取、构建、部署")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626425126026-1626425126010.png",alt:""}})]),t._v(" "),a("p",[t._v("来自：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626424995322-1626424995301.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"改为项目本地"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改为项目本地"}},[t._v("#")]),t._v(" 改为项目本地：")]),t._v(" "),a("p",[t._v("1、在流水线项目上修改：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626426369402-1626426369370.png",alt:""}})]),t._v(" "),a("p",[t._v("2、项目中，添加一个文件：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626426478007-1626426477966.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【触发】项目构建触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【触发】项目构建触发器"}},[t._v("#")]),t._v(" 【触发】项目构建触发器")]),t._v(" "),a("h3",{attrs:{id:"_1、触发远程构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、触发远程构建"}},[t._v("#")]),t._v(" 1、触发远程构建")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626459590220-1626459590214.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_2、其它工程构建后触发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、其它工程构建后触发"}},[t._v("#")]),t._v(" 2、其它工程构建后触发")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626459881414-1626459881392.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_3、定时构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、定时构建"}},[t._v("#")]),t._v(" 3、定时构建")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626489980663-1626489980633.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("每30分钟构建一次：H代表形参 H/30 * * * * 10:02 10:32\n\n每2个小时构建一次: H H/2 * * *\n\n每天的8点，12点，22点，一天构建3次： (多个时间点中间用逗号隔开) 0 8,12,22 * * *\n\n每天中午12点定时构建一次 H 12 * * *\n\n每天下午18点定时构建一次 H 18 * * *\n\n在每个小时的前半个小时内的每10分钟 H(0-29)/10 * * * *\n\n每两小时一次，每个工作日上午9点到下午5点(也许是上午10:38，下午12:38，下午2:38，下午4:38) H H(9-16)/2 * * 1-5\n")])])]),a("h3",{attrs:{id:"_4、轮询-scm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、轮询-scm"}},[t._v("#")]),t._v(" 4、轮询 SCM")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626490561413-1626490561372.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_5、代码仓库触发构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、代码仓库触发构建"}},[t._v("#")]),t._v(" 5、代码仓库触发构建")]),t._v(" "),a("p",[t._v("前面的几种构建触发器都不够好，就算是轮询SCM也会消耗我们的系统资源，拖慢jenkins的运行速度。下面我们就演示如果让gitlab来触发jenkins的项目构建。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626493715277-1626493715263.png",alt:""}})]),t._v(" "),a("p",[t._v("需要安装GitlabHook插件：需要安装两个插件： Gitlab Hook和GitLab")]),t._v(" "),a("p",[t._v("​\t1）项目触发器（复制下面图片首行的那个链接，备用）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626492610080-1626492610030.png",alt:""}})]),t._v(" "),a("p",[t._v("​\t2）在Jenkins中，Manage Jenkins->Conﬁgure System")]),t._v(" "),a("p",[t._v("不取消勾选，jenkins将不能正常接收gitlab发送的触发信息。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626492754499-1626492754469-382093cee2597d9990ee111babc36b21.jpg",alt:""}})]),t._v(" "),a("p",[t._v("3）gitlab：使用root管理员帐号登录，开启对应服务")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626493399071-1626493399029.png",alt:""}})]),t._v(" "),a("p",[t._v("4）使用项目账号登录，进入项目")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626493574213-1626493574200.png",alt:""}})]),t._v(" "),a("p",[t._v("进行如下 测试，回到jenkins发现触发了项目构建！")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626493633032-1626493633021.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【副加】参数化构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【副加】参数化构建"}},[t._v("#")]),t._v(" 【副加】参数化构建")]),t._v(" "),a("p",[t._v("1、jenkins项目中设置参数")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626510691515-1626510691500.png",alt:""}})]),t._v(" "),a("p",[t._v("2、在pipelish脚本中使用该参数")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626510755563-1626510755554.png",alt:""}})]),t._v(" "),a("p",[t._v("3、执行参数化构建项目 （已测试）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626510632687-1626510632683.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【邮箱】邮箱功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【邮箱】邮箱功能"}},[t._v("#")]),t._v(" 【邮箱】邮箱功能")]),t._v(" "),a("p",[t._v("以下步骤：邮箱服务开启  ->   jenkins配置")]),t._v(" "),a("p",[a("code",[t._v("邮箱服务开启")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626516270004-1626516269977.png",alt:""}})]),t._v(" "),a("p",[t._v("比如得到的授权码：CAPOTZETCGUFSOVC")]),t._v(" "),a("p",[a("code",[t._v("jenkins配置")])]),t._v(" "),a("p",[t._v("安装插件：Email Extension插件 template")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626515704616-1626515704587.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626516328030-1626516328027.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626516132502-1626516132500.png",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v('配置好上面后，现在我们开始应用到项目中。\n现在流程是这样的，现在我们在jenkins项目中，该项目是一个流水线+参数化的构建项目，在jenkins中需要设置拉取构建流程的"jenkinsfile" 的pipelish脚本文件。它可以不是项目本身：')])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626699189512-1626699189503.png",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("具体的项目构建由该脚本决定的~")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("pipeline "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   agent any\n\n   stages "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'pull code'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'GitSCM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" branches"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" '"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("branch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doGenerateSubmoduleConfigurations"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" extensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" submoduleCfg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userRemoteConfigs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'b632ed00"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("fc81"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v("c8"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a746"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("aa0673b2658'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'git"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@192.168.208.149")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("zhuangjie"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("web_demo_freestyle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'build project'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            sh 'mvn clean "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v("'\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("'publish project'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n         steps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            deploy adapters"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tomcat8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" '"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54d")]),t._v("ea36f"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("c9ed"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4925")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9d")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ea4ba77d7b78'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ''"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".208")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".151")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" contextPath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" war"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'target"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*.war'\n         }\n      }\n\n   }\n   post {\n         always {\n             emailext(\n                 subject: '构建通知：${PROJECT_NAME} - Build # ${BUILD_NUMBER} -${BUILD_STATUS}!',\n                 body: '${FILE,path=\"email.html\"}',\n                 to: '2119299531@qq.com'\n             )\n         }\n   }\n}\n")])])])]),a("p",[t._v("分析：pipeline  {stages...   post... }  其中stages是构建流程，"),a("code",[t._v("post")]),t._v("是构建成功后的操作。我们在此下的always（不管成功或失败，当然也可以是成功或失败）中发送邮件。")]),t._v(" "),a("p",[t._v("该脚本使用了以下作为邮件模板，位于项目的根目录下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626699623460-1626699623452.png",alt:""}})]),t._v(" "),a("p",[t._v("email.html")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v('${ENV, var="JOB_NAME"}-第${BUILD_NUMBER}次构建日志'),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("leftmargin")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("marginwidth")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("topmargin")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("marginheight")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("offset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("95%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("cellpadding")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("cellspacing")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value css language-css"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 11pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-family")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Tahoma"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Arial"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Helvetica"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sans-serif")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("(本邮件是程序自动下发的，请勿回复！)"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("font")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("color")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#0000FF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("构建结果 - ${BUILD_STATUS}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("font")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("font")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("color")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#0B610B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("构建信息"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("font")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("align")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("center"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("项目名称"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("${PROJECT_NAME}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("构建编号"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("第${BUILD_NUMBER}次构建"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("触发原因："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("${CAUSE}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("构建日志："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("${BUILD_URL}console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${BUILD_URL}console"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("构建"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("Url"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("${BUILD_URL}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${BUILD_URL}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("工作目录"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("${PROJECT_URL}ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${PROJECT_URL}ws"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("项目"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("Url"),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v("："),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("${PROJECT_URL}"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${PROJECT_URL}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("font")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("color")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#0B610B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Changes Since Last\n      Successful Build:"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("font")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("align")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("center"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("历史变更记录 : "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("${PROJECT_URL}changes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${PROJECT_URL}changes"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(' ${CHANGES_SINCE_LAST_SUCCESS,reverse=true, format="Changes for Build #%n:'),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("%c"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v('",showPaths=true,changesFormat="'),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("pre")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("[%a]"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("%m"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("pre")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v('",pathFormat="'),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),a("span",{pre:!0,attrs:{class:"token entity named-entity",title:"&nbsp;"}},[t._v("&nbsp;")]),t._v('%p"}\n    '),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Failed Test Results"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("align")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("center"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("pre")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value css language-css"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 11pt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-family")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Tahoma"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Arial"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Helvetica"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sans-serif")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("$FAILED_TESTS"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("pre")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("br")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("font")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("color")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("#0B610B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("构建日志 (最后 100行):"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("font")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("b")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("hr")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("100%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("align")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("center"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("textarea")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("cols")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rows")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("30"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("readonly")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("readonly"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token special-attr"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),a("span",{pre:!0,attrs:{class:"token value css language-css"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-family")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Courier New")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${BUILD_LOG, maxLines=100}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("textarea")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("td")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("tr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("table")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("除此，还需要设置邮箱这html格式进行发送：（在这下面搜索html,好像没有，但教程是这样的）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626704078478-1626704078470-image-20210719221412626.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【sonar代码审查】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【sonar代码审查】"}},[t._v("#")]),t._v(" 【Sonar代码审查】")]),t._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("注意，sonar6.7版本需要一个mysql5.7的数据库，jdk1.8以上比如8.5")]),t._v(" ，然后再创建一个名为"),a("code",[t._v("sonar")]),t._v(" 的数据库。然后再开始安装Sonar，启动后再开放端口且登录获取token ：")])]),t._v(" "),a("p",[t._v("以下步骤：保证存在名为sonar的数据库 ->  安装Conar  -> 余下工作")]),t._v(" "),a("p",[a("code",[t._v("保证存在名为sonar的数据库")])]),t._v(" "),a("p",[a("code",[t._v("安装Conar")])]),t._v(" "),a("p",[t._v("下载sonar压缩包： "),a("a",{attrs:{href:"https://www.sonarqube.org/downloads/",title:"https://www.sonarqube.org/downloads/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.sonarqube.org/downloads/"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" sonarqube-6.7.4.zip "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解压")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /opt/sonar "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" sonarqube-6.7.4/* /opt/sonar "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#移动文件")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useradd")]),t._v(" sonar "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建sonar用户，必须sonar用于启动，否则报错")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-R")]),t._v(" sonar. /opt/sonar "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#更改sonar目录及文件权限修改sonar配置文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-R")]),t._v(" sonar. /usr/local/jdk/  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不确定是否需要这个授权！！！")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("  /opt/sonarqube-6.7.4/conf/sonar.properties\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#编辑内容：四个地方设置username  passowrd  url  端口（不理默认9000）")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("sonar.jdbc.username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("sonar.jdbc.password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Root@123  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("sonar.jdbc.url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("jdbc:mysql://localhost:3306/sonar?useUnicode"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("characterEncoding")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("rewriteBatchedStatements")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("useConﬁgs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" maxPerformance"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("useSSL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("false\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/sonarqube-6.7.4\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#su sonar 不能使用root用户启动！！！所以下面在root用户下使用如下使用启动")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" sonar ./bin/linux-x86-64/sonar.sh start "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" sonar ./bin/linux-x86-64/sonar.sh status "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看状态")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" sonar ./bin/linux-x86-64/sonar.sh stop "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#停止")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tail")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" logs/sonar.logs "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看日志访问sonar http://192.168.66.101:9000")]),t._v("\n")])])]),a("p",[a("code",[t._v("余下工作")])]),t._v(" "),a("p",[t._v("1)开放端口：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("firewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#永久开放该端口")]),t._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--reload")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启防火墙")]),t._v("\n")])])]),a("p",[t._v("2)登录：默认  admin/admin")]),t._v(" "),a("p",[t._v("​\t获取token:")]),t._v(" "),a("p",[t._v("​\t输入admin , 得到如下信息,需要摘取保存token")]),t._v(" "),a("p",[t._v("​\tadmin: "),a("strong",[t._v("30ab099e4edef87ef92ca6217da084c0260de47c")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626709303395-1626709303372.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"sonar与jenkins整合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sonar与jenkins整合"}},[t._v("#")]),t._v(" Sonar与Jenkins整合")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626925229389-1626925229368.png",alt:""}})]),t._v(" "),a("p",[t._v("1、在Jenkins安装Sonar-Scanner工具")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626925200244-1626925200242-image-20210720211841704.png",alt:""}})]),t._v(" "),a("p",[t._v("2、整合")]),t._v(" "),a("p",[t._v("​\t1)在Jenkins中安装SonarQube Scanner插件，用于连接ConarQube")]),t._v(" "),a("p",[t._v("​\t2)、Manage Jenkins->Global Tool Conﬁguration  添加一个凭证")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626925096630-1626925096623-image-20210720211228770.png",alt:""}})]),t._v(" "),a("p",[t._v("​\t3)在jenkins“系统配置”中，作如下配置")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626925064354-1626925064346-image-20210720211416805.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"应用到项目构建中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用到项目构建中"}},[t._v("#")]),t._v(" 应用到项目构建中")]),t._v(" "),a("p",[a("strong",[t._v("JAVA_HOME等环境变量需要设置好！")]),t._v(" 我们应用在流水线的项目构建中，而其它的构建方式会相对简单。")]),t._v(" "),a("p",[t._v("以下步骤： 在项目中加入sonar-project.properties审查文件  ->  在pipelish脚本加入代码审查步骤")]),t._v(" "),a("p",[a("code",[t._v("1、在项目中加入sonar-project.properties审查文件")])]),t._v(" "),a("p",[t._v("在根目录下加入：")]),t._v(" "),a("p",[t._v("sonar-project.properties")]),t._v(" "),a("div",{staticClass:"language-.properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# must be unique in a given SonarQube instance\nsonar.projectKey=web_demo_pipline\n# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.\nsonar.projectName=web_demo_pipline\nsonar.projectVersion=1.0\n\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on Windows.\n# This property is optional if sonar.modules is set.\nsonar.sources=.\nsonar.exclusions=**/test/**,**/target/**\n\nsonar.java.source=1.8\nsonar.java.target=1.8\n\n# Encoding of the source code. Default is default system encoding\nsonar.sourceEncoding=UTF-8\n')])])]),a("p",[a("code",[t._v("2、在pipelish脚本加入代码审查步骤")])]),t._v(" "),a("p",[t._v("在代码构建打包好后（生成target后），进行代码的审查")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pipeline {\n   agent any\n\n   stages {\n      stage('pull code') {\n         steps {\n            checkout([$class: 'GitSCM', branches: [[name: '*/${branch}']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'b632ed00-fc81-43c8-a746-5aa0673b2658', url: 'git@192.168.208.149:zhuangjie/web_demo_freestyle.git']]])\n         }\n      }\n      stage('code checking') {\n          steps {\n              script {\n                   //引入SonarQubeScanner工具\n                  scannerHome = tool 'SonarQube-Scanner'   //第二步整合中安装Sonar-Scanner工具起的名字\n              }\n              //引入SonarQube的服务器环境\n              withSonarQubeEnv('ConarQube6.7') {  //第二步整合中配置进Jenkins中起的服务的名字\n                  sh \"${scannerHome}/bin/sonar-scanner\"\n              }\n          }\n      }\n      stage('build project') {\n         steps {\n            sh 'mvn clean package'\n         }\n      }\n      stage('publish project') {\n         steps {\n            deploy adapters: [tomcat8(credentialsId: '54dea36f-c9ed-4925-9d25-ea4ba77d7b78', path: '', url: 'http://192.168.208.153:8080')], contextPath: null, war: 'target/*.war'\n         }\n      }\n\n   }\n   post {\n         always {\n             emailext(\n                 subject: '构建通知：${PROJECT_NAME} - Build # ${BUILD_NUMBER} -${BUILD_STATUS}!',\n                 body: '${FILE,path=\"email.html\"}',\n                 to: '2119299531@qq.com'\n             )\n         }\n   }\n}\n")])])]),a("p",[t._v("然后进行代码的构建！首次会进行下载安装SonarQube Scanner")]),t._v(" "),a("p",[t._v("加入异常代码后进行构建，SonarQube中：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1626925023961-1626925023954-image-20210720223752856.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【分布式项目部署】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【分布式项目部署】"}},[t._v("#")]),t._v(" 【分布式项目部署】")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627046616524-1627046616423.png",alt:""}})]),t._v(" "),a("p",[t._v("大致流程说明：\n1）开发人员每天把代码提交到Gitlab代码仓库\n2）Jenkins从Gitlab中拉取项目源码，编译并打成jar包，然后构建成Docker镜像，将镜像上传到\nHarbor私有仓库。\n3）Jenkins发送SSH远程命令，让生产部署服务器到Harbor私有仓库拉取镜像到本地，然后创建容器。\n4）最后，用户可以访问到容器")]),t._v(" "),a("p",[t._v("【Docker环境】")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627046771291-1627046771238.png",alt:""}})]),t._v(" "),a("p",[t._v("Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。\nDocker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流\n行的 Linux 机器上，也可以实现虚拟化。\n容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销\n极低。")]),t._v(" "),a("p",[t._v("Docker容器技术 vs 传统虚拟机技术")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627046966863-1627046966759.png",alt:""}})]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("虚拟机")]),t._v(" "),a("th",[t._v("容器")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("占用磁盘空间")]),t._v(" "),a("td",[t._v("非常大,GB级")]),t._v(" "),a("td",[t._v("小，MB甚至KB级")])]),t._v(" "),a("tr",[a("td",[t._v("启动速度")]),t._v(" "),a("td",[t._v("慢，分钟级")]),t._v(" "),a("td",[t._v("快，秒级")])]),t._v(" "),a("tr",[a("td",[t._v("对运行形态")]),t._v(" "),a("td",[t._v("运行在Hypervisor上")]),t._v(" "),a("td",[t._v("直接运行在宿主机内核上")])]),t._v(" "),a("tr",[a("td",[t._v("并发性")]),t._v(" "),a("td",[t._v("一台宿主机上十几个，最多几十个")]),t._v(" "),a("td",[t._v("上百个，甚至数百上千个")])]),t._v(" "),a("tr",[a("td",[t._v("性能")]),t._v(" "),a("td",[t._v("逊于宿主机")]),t._v(" "),a("td",[t._v("接近宿主机本地进程")])]),t._v(" "),a("tr",[a("td",[t._v("资源利用率")]),t._v(" "),a("td",[t._v("低")]),t._v(" "),a("td",[t._v("高")])])])]),t._v(" "),a("p",[t._v("简单一句话总结：Docker"),a("strong",[t._v("技术就是让我们更加高效轻松地将任何应用在")]),t._v("Linux"),a("strong",[t._v("服务器部署和使用")])]),t._v(" "),a("h3",{attrs:{id:"【docker安装】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【docker安装】"}},[t._v("#")]),t._v(" 【Docker安装】")]),t._v(" "),a("p",[t._v("1）卸载旧版本")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum list installed "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出当前所有docker的包")]),t._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" remove docker-*  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#的包名称 卸载docker包")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" /var/lib/docker "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除docker的所有镜像和容器")]),t._v("\n")])])]),a("p",[t._v("2）安装必要的软件包")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" yum-utils  device-mapper-persistent-data  lvm2\n")])])]),a("p",[t._v("3）设置下载的镜像仓库")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#或使用加速镜像:  yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo")]),t._v("\n")])])]),a("p",[t._v("4）列出需要安装的版本列表")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum list docker-ce "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--showduplicates")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v("  \n")])])]),a("p",[t._v("5）安装指定版本（这里使用18.0.1版本）")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" docker-ce-18.06.1.ce\n")])])]),a("p",[t._v("6）查看版本&设置开机自启")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置开机启动  ")]),t._v("\nsystemctl is-enabled "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看是否设置为开机自启")]),t._v("\n")])])]),a("p",[t._v("7）启动Docker")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n")])])]),a("p",[t._v("8）添加阿里云镜像下载地址")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /etc/docker/daemon.json\n")])])]),a("p",[t._v("内容如下：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://zydiol88.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("9）重启Docker")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("  \nsystemctl status "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看docker状态")]),t._v("\n")])])]),a("p",[t._v("离线安装方式请参考："),a("a",{attrs:{href:"https://www.cnblogs.com/kingsonfu/p/11576797.html",title:"https://www.cnblogs.com/kingsonfu/p/11576797.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/kingsonfu/p/11576797.html"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"【docker命令】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【docker命令】"}},[t._v("#")]),t._v(" 【docker命令】")]),t._v(" "),a("p",[t._v("1）镜像命令：")]),t._v(" "),a("p",[t._v("镜像：相当于应用的安装包，在Docker部署的任何应用都需要先构建成为镜像")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" search 镜像名称 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#搜索镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull 镜像名称 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#拉取镜像 示例：docker pull nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看本地所有镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" 镜像名称 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除镜像(即使在运行)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qa")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除所有镜像")]),t._v("\n")])])]),a("p",[t._v("2）容器命令")]),t._v(" "),a("p",[t._v("容器：容器是由镜像创建而来。容器是Docker运行应用的载体，每个应用都分别运行在Docker的每个\n容器中。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-di")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" 对应宿主机那个端口:开放应用端口  镜像名称:标签 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#运行容器（默认是前台运行），di:i是运行，d是后台;  -p是public的意思;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看运行的容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询所有容器")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" 容器ID/容器名称 /bin/bash "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进入容器内部")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" start/stop/restart 容器名称/ID "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动/停止/重启容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" 容器名称/ID "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-q")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除所有容器")]),t._v("\n")])])]),a("h3",{attrs:{id:"【镜像的制作】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【镜像的制作】"}},[t._v("#")]),t._v(" 【镜像的制作】")]),t._v(" "),a("p",[t._v('下面将 "ttensquare_eureka_server-1.0-SNAPSHOT.jar" enreka微服务制作成一个docker镜像')]),t._v(" "),a("p",[t._v("1）上传Eureka的微服务jar包到linux\n2）编写Dockerfile")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("FROM openjdk:8-jdk-alpine\nARG JAR_FILE\nCOPY "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JAR_FILE}")]),t._v(" app.jar\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10086")]),t._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("3）构建镜像")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build --build-arg "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JAR_FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tensquare_eureka_server-1.0-SNAPSHOT.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" eureka:v1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),a("p",[t._v("4）查看镜像是否创建成功")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n")])])]),a("p",[t._v("5）创建容器")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("eureka "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10086")]),t._v(":10086 eureka:v1\n")])])]),a("p",[t._v("6）访问容器\n"),a("a",{attrs:{href:"http://192.168.66.101:10086",title:"http://192.168.66.101:10086",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://192.168.66.101:10086"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"【harbor安装】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【harbor安装】"}},[t._v("#")]),t._v(" 【Harbor安装】")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627212945189-1627212945174.png",alt:""}})]),t._v(" "),a("p",[t._v("简介：")]),t._v(" "),a("p",[t._v("Harbor（港口，港湾）是一个用于存储和分发Docker镜像的企业级Registry服务器。\n除了Harbor这个私有镜像仓库之外，还有Docker官方提供的Registry。相对Registry，Harbor具有很\n多优势：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("提供分层传输机制，优化网络传输 Docker镜像是是分层的，而如果每次传输都使用全量文件(所以\n用FTP的方式并不适合)，显然不经济。必须提供识别分层传输的机制，以层的UUID为标识，确定\n传输的对象。")])]),t._v(" "),a("li",[a("p",[t._v("提供WEB界面，优化用户体验 只用镜像的名字来进行上传下载显然很不方便，需要有一个用户界\n面可以支持登陆、搜索功能，包括区分公有、私有镜像。")])]),t._v(" "),a("li",[a("p",[t._v("支持水平扩展集群 当有用户对镜像的上传下载操作集中在某服务器，需要对相应的访问压力作分\n解。")])]),t._v(" "),a("li",[a("p",[t._v("良好的安全机制 企业中的开发团队有很多不同的职位，对于不同的职位人员，分配不同的权限，\n具有更好的安全性。")])])]),t._v(" "),a("p",[t._v("1）先安装Docker并启动Docker（已完成）")]),t._v(" "),a("p",[t._v("参考之前的安装过程\n2）先安装docker-compose")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-L")]),t._v(" https://github.com/docker/compose/releases/download/1.27.2/docker-compose-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /usr/local/bin/docker-compose  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/local/bin/docker-compose  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看版本")]),t._v("\n")])])]),a("p",[t._v("3）下载Harbor的压缩包（本课程版本为：v1.9.2）\n"),a("a",{attrs:{href:"https://github.com/goharbor/harbor/releases",title:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/goharbor/harbor/releases"),a("OutboundLink")],1),t._v("\n4）上传压缩包到linux，并解压")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-xzf")]),t._v(" harbor-offline-installer-v1.9.2.tgz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /opt/harbor\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" harbor/* /opt/harbor\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/harbor\n")])])]),a("p",[t._v("5）修改Harbor的配置")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" harbor.yml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改内容1:   hostname: 192.168.66.102")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#修改内容2:   port: 85")]),t._v("\n")])])]),a("p",[t._v("6）安装Harbor")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("./prepare\n./install.sh\n")])])]),a("p",[t._v("7）启动Harbor")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#docker-compose down -v #停止")]),t._v("\n")])])]),a("p",[t._v("8）访问Harbor\n"),a("a",{attrs:{href:"http://192.168.66.102:85",title:"http://192.168.66.102:85",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://192.168.66.102:85"),a("OutboundLink")],1),t._v("\n默认账户密码：admin/Harbor12345")]),t._v(" "),a("p",[t._v("你可能会遇到的问题："),a("a",{attrs:{href:"https://www.cnblogs.com/hallejuayahaha/p/13926575.html",title:"https://www.cnblogs.com/hallejuayahaha/p/13926575.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cnblogs.com/hallejuayahaha/p/13926575.html"),a("OutboundLink")],1),t._v(" （参考）博主遇到了docker-compose过低找不到，导致启动报错：")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@localhost zhuangjie]# docker-compose up -d #启动\nERROR: \n        Can't find a suitable configuration file in this directory or any\n        parent. Are you in the right directory?\n\n        Supported filenames: docker-compose.yml, docker-compose.yaml\n        \n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#解决")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-L")]),t._v(" https://github.com/docker/compose/releases/download/1.27.2/docker-compose-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("uname")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" /usr/local/bin/docker-compose\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +x /usr/local/bin/docker-compose\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker-compose")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--version")]),t._v("\n\n./install.sh "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#注意还要cd到Harbor根目录执行")]),t._v("\n")])])]),a("h3",{attrs:{id:"【项目与用户】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【项目与用户】"}},[t._v("#")]),t._v(" 【项目与用户】")]),t._v(" "),a("p",[t._v("登录后：")]),t._v(" "),a("p",[t._v("1）创建私有项目（项目分为公开项目与私有项目）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627218066729-1627218066687.png",alt:""}})]),t._v(" "),a("p",[t._v("2）创建用户")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627217685972-1627217685963.png",alt:""}})]),t._v(" "),a("p",[t._v("3）为项目添加成员：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627217922413-1627217922383.png",alt:""}})]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("角色")]),t._v(" "),a("th",[t._v("权限说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("访客")]),t._v(" "),a("td",[t._v("对于指定项目拥有只读权限")])]),t._v(" "),a("tr",[a("td",[t._v("开发人员")]),t._v(" "),a("td",[t._v("对于指定项目拥有读写权限")])]),t._v(" "),a("tr",[a("td",[t._v("维护人员")]),t._v(" "),a("td",[t._v("对于指定项目拥有读写权限，创建 Webhooks")])]),t._v(" "),a("tr",[a("td",[t._v("项目管理员")]),t._v(" "),a("td",[t._v("除了读写权限，同时拥有用户管理/镜像扫描等管理权限")])])])]),t._v(" "),a("h3",{attrs:{id:"【推送镜像到harbor】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【推送镜像到harbor】"}},[t._v("#")]),t._v(" 【推送镜像到Harbor】")]),t._v(" "),a("p",[t._v("1）给镜像打上标签")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" tag eureka:v1 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".208.157:85/uplog/eureka:v1\n")])])]),a("p",[t._v("2）推送镜像(会遇到二个问题，请解决)")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("问题1：需要把Harbor地址加入到Docker信任列表,不解决，推送会提示：\nvi /etc/docker/daemon.json\n需要重启Docker")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("The push refers to repository [192.168.66.102:85/tensquare/eureka]\nGet https://192.168.66.102:85/v2/: http: server gave HTTP response to HTTPS\nclient\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://zydiol88.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.87.102:85"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("问题2：权限不足，不解决，推送会提示：“denied: requested access to the resource is denied”")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#docker login -u 用户名 -p 密码 192.168.87.102:85")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost 桌面"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker login -u zhuangjie  -p gkmzjaznH21  192.168.87.102:85")]),t._v("\nLogin Succeeded\n")])])])]),t._v(" "),a("li",[a("p",[t._v("推送")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".208.157:85/uplog/eureka\n")])])])])]),t._v(" "),a("p",[t._v("3）登录Harbor查看")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627219857216-1627219857185.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"【从harbor拉取镜像】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【从harbor拉取镜像】"}},[t._v("#")]),t._v(" 【从Harbor拉取镜像】")]),t._v(" "),a("p",[t._v("存在Docker后，我们做以下准备，这样才能确保我们能从Harbor中拉取镜像：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("需要把Harbor地址加入到Docker信任列表,不解决，推送会提示：\nvi /etc/docker/daemon.json\n需要重启Docker")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("The push refers to repository [192.168.66.102:85/tensquare/eureka]\nGet https://192.168.66.102:85/v2/: http: server gave HTTP response to HTTPS\nclient\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://zydiol88.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(",\n "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.208.157:85"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("准备拉取")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" zhuangjie "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" zhuangJIE3333 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".208.157:85  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#登录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".208.157:85/uplog/eureka:v1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#拉取，该拉取命令直接从Harbor上一键复制")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看本地镜像")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"【微服务持续集成】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【微服务持续集成】"}},[t._v("#")]),t._v(" 【微服务持续集成】")]),t._v(" "),a("h3",{attrs:{id:"【将代码上传到gitlab】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【将代码上传到gitlab】"}},[t._v("#")]),t._v(" 【将代码上传到GitLab】")]),t._v(" "),a("p",[t._v("后端代码：注意要代码要添加打包的插件")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("前端代码：")]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("npm run dev  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#测试启动项目")]),t._v("\n")])])]),a("p",[t._v("在GitLab上分别创建两个项目，分别是前端的 "),a("strong",[t._v("tensquare_front")]),t._v("  与后端的 "),a("strong",[t._v("tensquare_back")]),t._v("  ，然后将代码分别上传到对应的项目仓库上去。")]),t._v(" "),a("h3",{attrs:{id:"【jenkins拉取与构建】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【jenkins拉取与构建】"}},[t._v("#")]),t._v(" 【Jenkins拉取与构建】")]),t._v(" "),a("p",[t._v("在jenkins上创建一个流水线的项目 “tensquare_back”  ，项目使用参数化（字符参数）构建：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627527217960-1627527217853.png",alt:""}})]),t._v(" "),a("p",[t._v("使用本地脚本进行构建：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627527398196-1627527398130.png",alt:""}})]),t._v(" "),a("p",[t._v("项目根目录“Jenkinsfile” 脚本文件：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git凭证ID")]),t._v("\ndef git_auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3b3eca2f-e2d7-44e5-8e11-e98ee29953dc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git的url地址")]),t._v("\ndef git_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@192.168.87.128:zhuangjie/tensquare_back.git"')]),t._v("\nnode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/${branch}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("doGenerateSubmoduleConfigurations")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extensions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("submoduleCfg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userRemoteConfigs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_auth}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_url}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后进行构建！")]),t._v(" "),a("h3",{attrs:{id:"【加入代码审查】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【加入代码审查】"}},[t._v("#")]),t._v(" 【加入代码审查】")]),t._v(" "),a("p",[t._v("在jenkins中加入一个构建参数（选项参数）：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627542931380-1627542931219.png",alt:""}})]),t._v(" "),a("p",[t._v("在项目代码中，编辑“Jenkinsfile” 文件加入代码审查的脚本代码：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git凭证ID(ssh)")]),t._v("\ndef git_auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3b3eca2f-e2d7-44e5-8e11-e98ee29953dc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git的url地址")]),t._v("\ndef git_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@192.168.87.128:zhuangjie/tensquare_back.git"')]),t._v("\nnode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/${branch}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("doGenerateSubmoduleConfigurations")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extensions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("submoduleCfg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userRemoteConfigs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_auth}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_url}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'代码审查'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        def scannerHome"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tool "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SonarQube-Scanner'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//jenkins>系统管理>全局工具配置>SonarQube Scanner>"Name"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withSonarQubeEnv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ConarQube6.7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//jenkins>系统管理>系统配置>SonarQube servers>"Name"')]),t._v("\n                sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n    cd $'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scannerHome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sonar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scanner\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n        '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("同时我们在每个微服务模块的根目录下加入“sonar-project.properties”  文件(注意模块间的该文件内容是不同的)：")]),t._v(" "),a("p",[t._v("tensquare_eureka_server模块：")]),t._v(" "),a("div",{staticClass:"language-.properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# must be unique in a given SonarQube instance\nsonar.projectKey=tensquare_eureka_server\n# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.\nsonar.projectName=tensquare_eureka_server\nsonar.projectVersion=1.0\n\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on Windows.\n# This property is optional if sonar.modules is set.\nsonar.sources=.\nsonar.exclusions=**/test/**,**/target/**\nsonar.java.binaries=.\n\nsonar.java.source=1.8\nsonar.java.target=1.8\n#sonar.java.libraries=**/target/classes/**\n\n# Encoding of the source code. Default is default system encoding\nsonar.sourceEncoding=UTF-8\n')])])]),a("p",[t._v("tensquare_zuul模块：")]),t._v(" "),a("div",{staticClass:"language-.properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# must be unique in a given SonarQube instance\nsonar.projectKey=tensquare_zuul\n# this is the name and version displayed in the SonarQube UI. Was mandatory prior to SonarQube 6.1.\nsonar.projectName=tensquare_zuul\nsonar.projectVersion=1.0\n\n# Path is relative to the sonar-project.properties file. Replace "\\" by "/" on Windows.\n# This property is optional if sonar.modules is set.\nsonar.sources=.\nsonar.exclusions=**/test/**,**/target/**\nsonar.java.binaries=.\n\nsonar.java.source=1.8\nsonar.java.target=1.8\n#sonar.java.libraries=**/target/classes/**\n\n# Encoding of the source code. Default is default system encoding\nsonar.sourceEncoding=UTF-8\n')])])]),a("p",[t._v("其它模块也是一样。然后进行代码构建，构建完后，我们可以访问Sonar来查看审查结果。")]),t._v(" "),a("h3",{attrs:{id:"【编译打包】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【编译打包】"}},[t._v("#")]),t._v(" 【编译打包】")]),t._v(" "),a("p",[t._v("我们需要将公共依赖进行安装，所以需要编辑项目根目录下 “Jenkinsfile”  脚本,加入“编译，安装公共子工程” 这个 阶段：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git凭证ID")]),t._v("\ndef git_auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3b3eca2f-e2d7-44e5-8e11-e98ee29953dc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git的url地址")]),t._v("\ndef git_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@192.168.87.133:zhuangjie/tensquare_back.git"')]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/${branch}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("doGenerateSubmoduleConfigurations")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extensions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("submoduleCfg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userRemoteConfigs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_auth}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_url}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'代码审查'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        def scannerHome"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tool "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SonarQube-Scanner'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//根据自己的Jenkinssonarqube-scanner环境修改")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withSonarQubeEnv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ConarQube6.7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//引入Jenkinssonarqube环境")]),t._v("\n                sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n    cd $'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scannerHome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sonar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scanner\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n        '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译，安装公共子工程'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mvn -f tensquare_common clean install"')]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v('然后在确保各个模块"pom.xml" 存在打包插件(父工程的该插件可以删除了)：')]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("这样就能确保依赖安装能完成了。下面我们就进行对可运行的微服务进行打包：")]),t._v(" "),a("p",[t._v("编辑项目根目录下 “Jenkinsfile”  脚本,加入“编译，打包微服务工程” 这个 阶段：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git凭证ID")]),t._v("\ndef git_auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3b3eca2f-e2d7-44e5-8e11-e98ee29953dc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git的url地址")]),t._v("\ndef git_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@192.168.87.133:zhuangjie/tensquare_back.git"')]),t._v("\n\n\nnode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/${branch}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("doGenerateSubmoduleConfigurations")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extensions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("submoduleCfg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userRemoteConfigs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_auth}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_url}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'代码审查'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        def scannerHome"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tool "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SonarQube-Scanner'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//根据自己的Jenkinssonarqube-scanner环境修改")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withSonarQubeEnv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ConarQube6.7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//引入Jenkinssonarqube环境")]),t._v("\n                sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n    cd $'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scannerHome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sonar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scanner\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n        '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译，安装公共子工程'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mvn -f tensquare_common clean install"')]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译，打包微服务工程'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mvn -f ${project_name}  clean package"')]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("因为zull这个模块时依赖了父模块，所以我们需要确保服务器的本地仓库有父工程：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost tensquare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pwd")]),t._v("\n/root/.m2/repository/com/tensquare\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost tensquare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mv /home/zhuangjie/桌面/tensquare_parent/ ./")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost tensquare"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ll")]),t._v("\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" root      root      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" 01:18 tensquare_common\ndrwxrwxrwx. "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" zhuangjie zhuangjie "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("58")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" 01:37 tensquare_parent\n")])])]),a("p",[t._v("我们移动的文件目录：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627549375224-1627549375170.png",alt:""}})]),t._v(" "),a("p",[t._v("然后再进行构建。这样我们在拉取的代码目录中就打包好了该模块的jar文件（测试jar可正常运行）。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1627549978651-1627549978565.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"【镜像制作】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【镜像制作】"}},[t._v("#")]),t._v(" 【镜像制作】")]),t._v(" "),a("p",[t._v("在每个模块中加入“Dockerfile” 文件（common不需要)：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#FROM java:8")]),t._v("\nFROM openjdk:8-jdk-alpine\nARG JAR_FILE\nCOPY "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${JAR_FILE}")]),t._v(" app.jar\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10020")]),t._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("在模块pom.xml中加入插件(common不需要)：")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("com.spotify"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("dockerfile-maven-plugin"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.3.6"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("repository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("${project.artifactId}"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("repository")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("buildArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("JAR_FILE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("target/${project.build.finalName}.jar"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("JAR_FILE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("buildArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("plugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("然后编辑 “Jenkinsfile” (加入："),a("strong",[t._v("dockerfile:build")]),t._v(" 来触发制作镜像)：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git凭证ID")]),t._v("\ndef git_auth "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3b3eca2f-e2d7-44e5-8e11-e98ee29953dc"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//git的url地址")]),t._v("\ndef git_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@192.168.87.133:zhuangjie/tensquare_back.git"')]),t._v("\n\nnode "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'拉取代码'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*/${branch}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("doGenerateSubmoduleConfigurations")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extensions")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("submoduleCfg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userRemoteConfigs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_auth}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${git_url}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'代码审查'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        def scannerHome"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tool "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SonarQube-Scanner'")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//根据自己的Jenkinssonarqube-scanner环境修改")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withSonarQubeEnv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ConarQube6.7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//引入Jenkinssonarqube环境")]),t._v("\n                sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n    cd $'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("scannerHome"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sonar"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scanner\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v('"\n        '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译，安装公共子工程'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mvn -f tensquare_common clean install"')]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'编译，打包微服务工程'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     sh "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mvn -f ${project_name}  clean package dockerfile:build"')]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("然后在jenkins点击构建。完成后：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看镜像，就会发现多出一个镜像文件，查看时间是刚刚制作的")]),t._v("\n")])])]),a("h3",{attrs:{id:"【应用部署】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【应用部署】"}},[t._v("#")]),t._v(" 【应用部署】")]),t._v(" "),a("p",[t._v("以下步骤：")]),t._v(" "),a("p",[t._v("1）在jenkins安装 Publish Over SSH插件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628080915258-1628080915249.png",alt:""}})]),t._v(" "),a("p",[t._v('2）确保jenkins（101）服务器有.ssh如果没有使用命令 "ssh-keygen" 生成。然后使用命令 "ssh-copy-id 192.168.87.103" 将公钥copy到web（103）服务器中')]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628082119907-1628082119768.png",alt:""}})]),t._v(" "),a("p",[t._v('3）在jenkins 的”全局配置“中配置"Publish over SSH" 的内容。怎么配置？')]),t._v(" "),a("p",[t._v("【Passphrse】密码，好像没有设置，如果设置了，需要填写。\n【Path to key】key文件的路径（私钥）/root/.ssh/id_rsa\n【Key】为空，也 可以测试成功**。注意如果 “/root/.ssh/id_rsa” 文件找不到需要将.ssh的私钥粘贴到文本框中，至于是root还是其它用户，要看使用copy命令时用的是哪个用户执行的了。**")]),t._v(" "),a("p",[t._v("【SSH Server Name】标识的名字，随便你取什么名字\n【Hostname】需要连接ssh的主机名或ip地址，此处填写应用服务器IP（建议ip）\n【Username】用户名\n【Remote Directory】远程目录(根据需要填写文件传到此目录下)\n【Test Configuration】配置完成，点击test会显示Success![]")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628093028483-1628093028472.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628083784632-1628083784445.png",alt:""}})]),t._v(" "),a("p",[t._v('4）在jenkins项目配置中添加一个"字符参数" + 在项目代码中修改 "Jenkinsfile" 文件 + 上传部署脚本到web服务器中（需要授于执行权限 chmod +x deploy.sh ）')]),t._v(" "),a("p",[t._v("steps1:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628093531296-1628093531286.png",alt:""}})]),t._v(" "),a("p",[t._v("steps2:  加入“应用部署”")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//git凭证ID\ndef git_auth = "da1d1333-c35f-415a-903c-b8d58c870c56"\n//git的url地址\ndef git_url = "git@192.168.87.100:zhuangjie/tensquare_back.git"\n\n//镜像的版本号\ndef tag = "latest"\n//Harbor的url地址\ndef harbor_url = "192.168.87.102:85"\n//镜像库项目名称\ndef harbor_project = "uplog"\n//Harbor的登录凭证ID\ndef harbor_auth = "ef2651c8-92a7-4edb-b4ca-4e182fadf0ca"\n\nnode {\n//    //获取当前选择的项目名称\n//    def selectedProjectNames = "${project_name}".split(",")\n//    //获取当前选择的服务器名称\n//    def selectedServers = "${publish_server}".split(",")\n\n   stage(\'拉取代码\') {\n      checkout([$class: \'GitSCM\', branches: [[name: "*/${branch}"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: "${git_auth}", url: "${git_url}"]]])\n   }\n   stage(\'代码审查\') {\n        def scannerHome=tool \'SonarQube-Scanner\'//根据自己的Jenkinssonarqube-scanner环境修改\n        withSonarQubeEnv(\'SonarQube6.7\'){ //引入Jenkinssonarqube环境\n                sh """\n    cd ${project_name}\n    ${scannerHome}/bin/sonar-scanner\n  """\n        }\n\n\n   }\n   stage(\'编译，安装公共子工程\') {\n     sh "mvn -f tensquare_common clean install"\n   }\n   stage(\'编译，打包微服务工程，上传镜像\') {\n   sh "echo \'开始制作镜像\'"\n     sh "mvn -f ${project_name}  clean package dockerfile:build"\n    sh "echo \'镜像制作好了\'"\n      //定义镜像名称\n                    def imageName = "${project_name}:${tag}"\n                   //对镜像打上标签\n                   sh "docker tag ${imageName} ${harbor_url}/${harbor_project}/${imageName}"\n                   //把镜像推送到Harbor\n               withCredentials([usernamePassword(credentialsId: "${harbor_auth}", passwordVariable: \'password\', usernameVariable: \'username\')]) {\n\n                       //登录到Harbor\n                       sh "docker login -u ${username} -p ${password} ${harbor_url}"\n                       //镜像上传\n                       sh "docker push ${harbor_url}/${harbor_project}/${imageName}"\n                       sh "echo 镜像上传成功"\n              }\n              sh "echo \'应用部署开始\'"\n                sshPublisher(publishers: [\n                            sshPublisherDesc(configName: \'master_server\',\n                            transfers: [\n                                sshTransfer(cleanRemote: false,\n                                excludes: \'\',\n                                // 触发的命令，deploy.sh\n                                execCommand: "/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project $project_name $tag $port",\n                                execTimeout: 120000,\n                                flatten: false,\n                                makeEmptyDirs: false,\n                                noDefaultExcludes: false,\n                                patternSeparator: \'[ , ]+\',\n                                remoteDirectory: \'\',\n                                remoteDirectorySDF: false,\n                                removePrefix: \'\',\n                                sourceFiles: \'\')\n                            ],\n                            usePromotionTimestamp: false,\n                            useWorkspaceInPromotion: false,\n                            verbose: false)\n                ])\n                sh "echo \'应用部署结束\'"\n   }\n\n}\n')])])]),a("p",[t._v("与之前相比添加了：")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("....\n\nsh \"echo '应用部署开始'\"\n                sshPublisher(publishers: [\n                            sshPublisherDesc(configName: 'master_server',\n                            transfers: [\n                                sshTransfer(cleanRemote: false,\n                                excludes: '',\n                                // 触发的命令，deploy.sh\n                                execCommand: \"/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project $project_name $tag $port\",\n                                execTimeout: 120000,\n                                flatten: false,\n                                makeEmptyDirs: false,\n                                noDefaultExcludes: false,\n                                patternSeparator: '[ , ]+',\n                                remoteDirectory: '',\n                                remoteDirectorySDF: false,\n                                removePrefix: '',\n                                sourceFiles: '')\n                            ],\n                            usePromotionTimestamp: false,\n                            useWorkspaceInPromotion: false,\n                            verbose: false)\n                ])\n                sh \"echo '应用部署结束'\"\n                \n....\n")])])]),a("p",[t._v("5）上传部署脚本到指定目录下（上面的Jenkinsfile部署代码中指定的路径）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628085614649-1628085614604.png",alt:""}})]),t._v(" "),a("p",[t._v("注意：需要确保我们jenkins（101服务器）与web（103）服务器能正常登录Harbor（102）服务器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628094317092-1628094317018.png",alt:""}})]),t._v(" "),a("p",[t._v("6）执行部署")]),t._v(" "),a("p",[t._v("在web(103)服务器中，执行“docker ps -a”命令就会发现我们构建的项目正在运行：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628093983955-1628093983885.png",alt:""}})]),t._v(" "),a("p",[t._v("访问：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628094028736-1628094028724.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"【后端代码部署优化】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【后端代码部署优化】"}},[t._v("#")]),t._v(" 【后端代码部署优化】")]),t._v(" "),a("h3",{attrs:{id:"【代码的修改】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【代码的修改】"}},[t._v("#")]),t._v(" 【代码的修改】")]),t._v(" "),a("p",[t._v("主要是注册中心，其它微服务模块的修改是一样的。")]),t._v(" "),a("ul",[a("li",[t._v("Eureka 的 application.yml：")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 集群版")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10086")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" EUREKA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("HA\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10086")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定profile=eureka-server1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("profiles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定当profile=eureka-server1时，主机名是eureka-server1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.87.103\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将自己注册到eureka-server1、eureka-server2这个Eureka上面去")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.87.103"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10086/eureka/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.87.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10086/eureka/\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10086")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("profiles")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server2\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.87.104\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.87.103"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10086/eureka/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.87.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10086/eureka/\n")])])]),a("p",[t._v("在启动微服务的时候，加入参数: spring.profiles.active 来读取对应的配置，使不同的机器应用不同的配置。")]),t._v(" "),a("ul",[a("li",[t._v("除了Eureka注册中心以外，其他微服务配置都需要加入所有Eureka服务")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka配置")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.87.103"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10086/eureka/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.168.87.104"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10086/eureka/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Eureka访问地址")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("prefer-ip-address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("h3",{attrs:{id:"【jenkins中创建项目】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【jenkins中创建项目】"}},[t._v("#")]),t._v(" 【jenkins中创建项目】")]),t._v(" "),a("p",[t._v('创建一个名为 "tensquare_back_cluster" 的流水线项目，并')]),t._v(" "),a("p",[t._v("进行参数化构建：")]),t._v(" "),a("p",[t._v("tensquare_eureka_server@10086,tensquare_zuul@10020,tensquare_admin_service@9001,tensquare_gathering@9002")]),t._v(" "),a("p",[t._v("注册中心,服务网关,权限服务,活动服务")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628517339350-1628517339044.png",alt:""}})]),t._v(" "),a("p",[t._v("此时的构建效果：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628517441217-1628517441081.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"【代码审查】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【代码审查】"}},[t._v("#")]),t._v(" 【代码审查】")]),t._v(" "),a("p",[t._v("修改项目“"),a("strong",[t._v("Jenkinsfile")]),t._v("” 文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628521417094-1628521416987-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90todo.png",alt:""}})]),t._v(" "),a("p",[t._v("此时的完整Jenkinsfile内容：")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//git凭证ID\ndef git_auth = "da1d1333-c35f-415a-903c-b8d58c870c56"\n//git的url地址\ndef git_url = "git@192.168.87.100:zhuangjie/tensquare_back.git"\n\n//镜像的版本号\ndef tag = "latest"\n//Harbor的url地址\ndef harbor_url = "192.168.87.102:85"\n//镜像库项目名称\ndef harbor_project = "uplog"\n//Harbor的登录凭证ID\ndef harbor_auth = "ef2651c8-92a7-4edb-b4ca-4e182fadf0ca"\n\nnode {\n    //获取当前选择的项目名称\n    def selectedProjectNames = "${project_name}".split(",")\n\n\n   stage(\'拉取代码\') {\n      checkout([$class: \'GitSCM\', branches: [[name: "*/${branch}"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: "${git_auth}", url: "${git_url}"]]])\n   }\n   stage(\'代码审查\') {\n        for (int i=0; i<selectedProjectNames.length; i++) {\n            //tensquare_eureka_server@10086\n            def projectInfo = selectedProjectNames[i];\n            //当前遍历的项目名称\n            def currentProjectName = "${projectInfo}".split("@")[0]\n            //当前遍历的项目端口\n            def currentProjectPort = "${projectInfo}".split("@")[1]\n            def scannerHome=tool \'SonarQube-Scanner\'//根据自己的Jenkinssonarqube-scanner环境修改\n            withSonarQubeEnv(\'SonarQube6.7\'){ //引入Jenkinssonarqube环境\n                sh """\n                cd ${currentProjectName}\n                ${scannerHome}/bin/sonar-scanner\n              """\n            }\n\n        }\n\n\n   }\n   stage(\'编译，安装公共子工程\') {\n     sh "mvn -f tensquare_common clean install"\n   }\n   stage(\'编译，打包微服务工程，上传镜像\') {\n   sh "echo \'开始制作镜像\'"\n     sh "mvn -f ${project_name}  clean package dockerfile:build"\n    sh "echo \'镜像制作好了\'"\n      //定义镜像名称\n                    def imageName = "${project_name}:${tag}"\n                   //对镜像打上标签\n                   sh "docker tag ${imageName} ${harbor_url}/${harbor_project}/${imageName}"\n                   //把镜像推送到Harbor\n               withCredentials([usernamePassword(credentialsId: "${harbor_auth}", passwordVariable: \'password\', usernameVariable: \'username\')]) {\n\n                       //登录到Harbor\n                       sh "docker login -u ${username} -p ${password} ${harbor_url}"\n                       //镜像上传\n                       sh "docker push ${harbor_url}/${harbor_project}/${imageName}"\n                       sh "echo 镜像上传成功"\n              }\n              sh "echo \'应用部署开始\'"\n                sshPublisher(publishers: [\n                            sshPublisherDesc(configName: \'master_server\',\n                            transfers: [\n                                sshTransfer(cleanRemote: false,\n                                excludes: \'\',\n                                // 触发的命令，deploy.sh\n                                execCommand: "/opt/jenkins_shell/deploy.sh $harbor_url $harbor_project $project_name $tag $port",\n                                execTimeout: 120000,\n                                flatten: false,\n                                makeEmptyDirs: false,\n                                noDefaultExcludes: false,\n                                patternSeparator: \'[ , ]+\',\n                                remoteDirectory: \'\',\n                                remoteDirectorySDF: false,\n                                removePrefix: \'\',\n                                sourceFiles: \'\')\n                            ],\n                            usePromotionTimestamp: false,\n                            useWorkspaceInPromotion: false,\n                            verbose: false)\n                ])\n                sh "echo \'应用部署结束\'"\n   }\n\n}\n')])])]),a("h3",{attrs:{id:"【上传镜像到harbor】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【上传镜像到harbor】"}},[t._v("#")]),t._v(" 【上传镜像到Harbor】")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628648447700-1628648447686-image-20210810234710355.png",alt:""}})]),t._v(" "),a("p",[t._v("如果想要构建成功还需要修改jenkinsfile“应用部署“中的（项目名称与端口）：")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(' ....\nexecCommand: "/opt/jenkins_shell/deployCluster.sh $harbor_url $harbor_project $currentProjectName $tag $currentProjectPort",\n ....\n')])])]),a("h3",{attrs:{id:"【应用部署】-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【应用部署】-2"}},[t._v("#")]),t._v(" 【应用部署】")]),t._v(" "),a("p",[t._v("分布式应用部署，我们需要再加入一台web服务器：")]),t._v(" "),a("p",[t._v("1）需要在jenkins服务器中执行  ssh-copy-id 192.168.66.104 到新的web的服务器")]),t._v(" "),a("p",[t._v("2）在新的web服务器中： vi /etc/docker/daemon.json")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628605176931-1628605176910.png",alt:""}})]),t._v(" "),a("p",[t._v("3）系统配置->添加远程服务器")]),t._v(" "),a("p",[t._v("在jenkins（Publish over SSH）中配置一台web服务器")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628611001560-1628611001547.png",alt:""}})]),t._v(" "),a("ol",[a("li",[t._v("修改流水线项目")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628648405698-1628648405683-image-20210811001519165.png",alt:""}})]),t._v(" "),a("p",[t._v("部署效果：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628648388613-1628648388594-image-20210811002247011.png",alt:""}})]),t._v(" "),a("p",[t._v('5）修改项目"Jenkinsfile" 文件配置：')]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628648377303-1628648377290-image-20210811001121364.png",alt:""}})]),t._v(" "),a("p",[t._v("完整”Jenkinsfile“:")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('//git凭证ID\ndef git_auth = "da1d1333-c35f-415a-903c-b8d58c870c56"\n//git的url地址\ndef git_url = "git@192.168.87.100:zhuangjie/tensquare_back.git"\n\n//镜像的版本号\ndef tag = "latest"\n//Harbor的url地址\ndef harbor_url = "192.168.87.102:85"\n//镜像库项目名称\ndef harbor_project = "uplog"\n//Harbor的登录凭证ID\ndef harbor_auth = "ef2651c8-92a7-4edb-b4ca-4e182fadf0ca"\n\nnode {\n    //获取当前选择的项目名称\n    def selectedProjectNames = "${project_name}".split(",")\n    //把选择的服务器信息转为数组\n    def selectedServers = "${publish_server}".split(\',\')\n\n   stage(\'拉取代码\') {\n      checkout([$class: \'GitSCM\', branches: [[name: "*/${branch}"]], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: "${git_auth}", url: "${git_url}"]]])\n   }\n   stage(\'代码审查\') {\n        for (int i=0; i<selectedProjectNames.length; i++) {\n            //tensquare_eureka_server@10086\n            def projectInfo = selectedProjectNames[i];\n            //当前遍历的项目名称\n            def currentProjectName = "${projectInfo}".split("@")[0]\n            //当前遍历的项目端口\n            def currentProjectPort = "${projectInfo}".split("@")[1]\n            def scannerHome=tool \'SonarQube-Scanner\'//根据自己的Jenkinssonarqube-scanner环境修改\n            withSonarQubeEnv(\'SonarQube6.7\'){ //引入Jenkinssonarqube环境\n                sh """\n                cd ${currentProjectName}\n                ${scannerHome}/bin/sonar-scanner\n              """\n            }\n\n        }\n\n\n   }\n   stage(\'编译，安装公共子工程\') {\n     sh "mvn -f tensquare_common clean install"\n   }\n   stage(\'编译，打包微服务工程，上传镜像\') {\n        for (int i=0; i<selectedProjectNames.length; i++) {\n            //tensquare_eureka_server@10086\n            def projectInfo = selectedProjectNames[i];\n            //当前遍历的项目名称\n            def currentProjectName = "${projectInfo}".split("@")[0]\n            //当前遍历的项目端口\n            def currentProjectPort = "${projectInfo}".split("@")[1]\n            sh "echo \'开始制作镜像\'"\n            sh "mvn -f ${currentProjectName}  clean package dockerfile:build"\n            sh "echo \'镜像制作好了\'"\n            //定义镜像名称\n            def imageName = "${currentProjectName}:${tag}"\n            //对镜像打上标签\n            sh "docker tag ${imageName} ${harbor_url}/${harbor_project}/${imageName}"\n            //把镜像推送到Harbor\n            withCredentials([usernamePassword(credentialsId: "${harbor_auth}", passwordVariable: \'password\', usernameVariable: \'username\')]) {\n                    //登录到Harbor\n                    sh "docker login -u ${username} -p ${password} ${harbor_url}"\n                    //镜像上传\n                    sh "docker push ${harbor_url}/${harbor_project}/${imageName}"\n                    sh "echo 镜像上传成功"\n            }\n           //=====以下为远程调用进行项目部署========\n           for(int j=0; j<selectedServers.size(); j++){\n               //每个服务名称\n               def currentServer = selectedServers[j]\n               //添加微服务运行时的参数：spring.profiles.active\n               def activeProfile = "--spring.profiles.active="\n               if(currentServer=="master_server"){\n                    activeProfile = activeProfile+"eureka-server1"\n               }else if(currentServer=="slave_server1"){\n                    activeProfile = activeProfile+"eureka-server2"\n               }\n                sh "echo \'应用部署开始\'"\n                sshPublisher(publishers: [\n                       sshPublisherDesc(configName: "${currentServer}",\n                       transfers: [\n                           sshTransfer(cleanRemote: false,\n                           excludes: \'\',\n                           // 触发的命令，deploy.sh\n                           execCommand: "/opt/jenkins_shell/deployCluster.sh $harbor_url $harbor_project $currentProjectName $tag $currentProjectPort",\n                           execTimeout: 120000,\n                           flatten: false,\n                           makeEmptyDirs: false,\n                           noDefaultExcludes: false,\n                           patternSeparator: \'[ , ]+\',\n                           remoteDirectory: \'\',\n                           remoteDirectorySDF: false,\n                           removePrefix: \'\',\n                           sourceFiles: \'\')\n                       ],\n                       usePromotionTimestamp: false,\n                       useWorkspaceInPromotion: false,\n                       verbose: false)\n                ])\n                sh "echo \'应用部署结束\'"\n            }\n        }\n   }\n\n}\n')])])]),a("p",[t._v('6）在两个生产服务器中 "/opt/jenkins_shell" 目录下加入 "deployCluster.sh" 脚本，并授予执行权限；')]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628648361824-1628648361791-image-20210811001811353.png",alt:""}})]),t._v(" "),a("p",[t._v("deployCluster.sh")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#! /bin/sh")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#接收外部参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("harbor_url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("harbor_project_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("project_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$4")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$5")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("profile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$6")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("imageName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$harbor_url")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$harbor_project_name")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$project_name")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tag")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$imageName")]),t._v('"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询容器是否存在，存在则删除")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("containerId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(":$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("tag"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$containerId")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#停掉容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$containerId")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除容器")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$containerId")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"成功删除容器"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询镜像是否存在，存在则删除")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("imageId")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" $project_name  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{print $3}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$imageId")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n      \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#删除镜像")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$imageId")]),t._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"成功删除镜像"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 登录Harbor")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" zhuangjie "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" gkmzjaznH21 "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$harbor_url")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载镜像")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$imageName")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动容器")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-di")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$port")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$imageName")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$profile")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"容器启动成功"')]),t._v("\n")])])]),a("p",[t._v("注意：需要修改 Harbor 登录信息。")]),t._v(" "),a("h3",{attrs:{id:"【高可用的nginx】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【高可用的nginx】"}},[t._v("#")]),t._v(" 【高可用的nginx】")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/18476305640/typora@master/image/1628686966488-1628686966378.png",alt:""}})]),t._v(" "),a("p",[t._v("1）安装Nginx（已完成）")]),t._v(" "),a("p",[t._v("2）配置nginx")]),t._v(" "),a("div",{staticClass:"language-纯文本 extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream zuulServer {\n        server 192.168.87.103:10020 weight=1;\n        server 192.168.87.104:10020 weight=1;\n}\nserver {\n        listen       9090;\n        listen       [::]:80;\n        server_name  _;\n        root         /usr/share/nginx/html;\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n           proxy_pass http://zuulServer/;\n    }\n...\n\n")])])]),a("p",[t._v("3）重启nginx")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("systemctl restart nginx\n")])])]),a("p",[a("RouterLink",{attrs:{to:"/note/DevOps/Jenkins/Jenkins实战/Jenkins实战.html",title:"Jenkins实战"}},[t._v("Jenkins实战")])],1)])}),[],!1,null,null,null);a.default=e.exports}}]);